# Multi-AZ Configuration for EC2 Instance 2 (AZ: ap-southeast-1b)
# Copy this file to .env on EC2-2

# =================================
# DATABASE CONFIGURATION - AZ2
# =================================
# PostgreSQL Replica configuration
POSTGRES_MASTER_HOST=PRIVATE_IP_1
# MongoDB Replica Set
MONGODB_CLUSTER_URI=mongodb://PRIVATE_IP_1:27017,PRIVATE_IP_2:27017/driver-db?replicaSet=rs0
# Redis Replica
REDIS_MASTER_HOST=PRIVATE_IP_1
REDIS_REPLICA_OF=true

# =================================
# KAFKA KRAFT CONFIGURATION - AZ2
# =================================
KAFKA_NODE_ID=2
KAFKA_CONTROLLER_QUORUM_VOTERS=1@PRIVATE_IP_1:9093,2@PRIVATE_IP_2:9093
PRIVATE_IP=PRIVATE_IP_2
KAFKA_BOOTSTRAP_SERVERS=PRIVATE_IP_1:9092,PRIVATE_IP_2:9092
KAFKA_REPLICATION_FACTOR=2
KAFKA_MIN_ISR=1
KAFKA_CLUSTER_ID=I4J7QqmjSQ2CXwNIBkRrxA

# =================================
# ELK CONFIGURATION - AZ2
# =================================
ES_NODE_NAME=es-node-2
ES_DISCOVERY_HOSTS=PRIVATE_IP_1,PRIVATE_IP_2
ES_INITIAL_MASTERS=es-node-1,es-node-2
ELASTICSEARCH_HOSTS=http://PRIVATE_IP_1:9200,http://PRIVATE_IP_2:9200

# =================================
# MICROSERVICES CONFIGURATION
# =================================
POSTGRES_CLUSTER_URL=jdbc:postgresql://PRIVATE_IP_1:5432/auth_service_db
REDIS_CLUSTER_HOST=PRIVATE_IP_1
REDIS_CLUSTER_NODES=PRIVATE_IP_1:6379,PRIVATE_IP_2:6379

# =================================
# INSTRUCTIONS FOR SETUP:
# =================================
# 1. Replace PRIVATE_IP_1 with actual private IP of EC2-1
# 2. Replace PRIVATE_IP_2 with actual private IP of EC2-2
# 3. Copy this file to .env on EC2-2
# 4. Format Kafka storage: docker run --rm -v kafka_data:/tmp/kraft-combined-logs confluentinc/cp-kafka:7.5.0 kafka-storage format -t $(docker run --rm confluentinc/cp-kafka:7.5.0 kafka-storage random-uuid) -c /etc/kafka/kraft/server.properties
# 5. Run: docker-compose -f docker-compose-databases.yml -f docker-compose-kafka.yml -f docker-compose-elk.yml -f docker-compose-services.yml up -d